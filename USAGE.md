# HYPay 机器人使用说明书

## 📖 目录
1. [新手入门](#1-新手入门)
2. [群组记账指令](#2-群组记账指令)
3. [设置与管理](#3-设置与管理)
4. [工具与查询](#4-工具与查询)
5. [管理员后台操作](#5-管理员后台操作)

---

## 1. 新手入门

### 1.1 申请授权
1. 私聊机器人，点击底部键盘的 **「试用」** 按钮。
2. 系统会自动提交申请，等待管理员审核。
3. 审核通过后，你会收到通知，即可将机器人拉入群组使用。

### 1.2 激活机器人
- 将机器人拉入群组，并设为管理员。
- 在群内发送 **「开始」** 即可开启当天的记账功能。

---

## 2. 群组记账指令

**基础记账：**
- **入款**：发送 `+100` 或 `入款100` （记录入款 100 元）
- **入款修正**：发送 `+-100` 或 `入款-100` （扣除 100 元入款）
- **下发**：发送 `下发100` （记录下发 100 元）
- **U下发**：发送 `下发100u` （记录下发 100 USDT，需先设置汇率）

**账单查询：**
- **显示账单**：查看当前各项总计及最近 5 笔交易记录。
- **账单详情**：点击显示账单下方的「点击跳转完整账单」查看网页版详细报表。

**日结操作：**
- **结束记录**：停止今日记账（通常在每日结束时发送）。
- **清理今天数据**：清空今日所有流水（⚠️ 慎用，仅限管理员）。

---

## 3. 设置与管理

**费率与汇率：**
- **设置费率**：发送 `设置费率5%` 或 `更改费率5%`。
- **设置汇率**：
    - `设置美元汇率 7.3`
    - `设置比索汇率 56`
    - `设置马币汇率 1.5`
    - `设置泰铢汇率 5.0`

**显示模式：**
- `设置为无小数`：金额取整显示。
- `设置为计数模式`：只显示总入款，隐藏下发和费率详情（适合简洁需求）。
- `设置为原始模式`：恢复默认详细显示，保留小数。

**人员管理：**
- **设置操作人**：发送 `设置操作人 @用户` （允许该用户在群内记账）。
- **删除操作人**：发送 `删除操作人 @用户`。
- **显示操作人**：查看当前群内的授权操作员列表。

---

## 4. 工具与查询

**USDT 实时价格计算：**
- **银行卡 (Card)**：发送 `k100` （计算 100 元银行卡汇率换算多少 U）。
- **支付宝 (Ali)**：发送 `z100`。
- **微信 (WeChat)**：发送 `w100`。

**实时汇率查询：**
- 发送 `lk`：查询银行卡汇率。
- 发送 `lz`：查询支付宝汇率。
- 发送 `lw`：查询微信汇率。

---

## 5. 管理员后台操作 (Super Admin)

作为机器人拥有者，你可以通过 API 或后台管理整个系统。

### 5.1 授权管理 (新功能)
- **查看申请**：`GET /admin/trials/pending`
- **批准试用**：`POST /admin/trials/{request_id}/approve`
    - 批准后用户获得试用权限，并收到通知。
- **拒绝申请**：`POST /admin/trials/{request_id}/reject`

### 5.2 激活码管理
- **生成激活码**：`POST /admin/license/generate?days=30`
    - 生成一个 30 天的激活码，用户可用 `/activate HY-XXXX` 自助激活。

### 5.3 机器人管理
- **新增 Bot**：`POST /admin/bot/create`
    - 参数：`{"token": "123456:ABC...", "name": "客服1号"}`
    - 系统会自动启动新 Bot，无需重启服务。

### 5.4 数据导出
- **导出 Excel**：`GET /admin/group/{chat_id}/export?date=2023-10-27`
    - 下载指定群组、指定日期的详细账单 Excel 文件。
